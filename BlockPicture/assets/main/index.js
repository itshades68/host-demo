System.register("chunks:///_virtual/BlockController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameManager.ts","./BlockHighlight.ts"],(function(t){var i,o,s,n,e,r,a,h,l,c,u,g,_,d,T,p,y,f,v,P;return{setters:[function(t){i=t.applyDecoratedDescriptor,o=t.inheritsLoose,s=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){e=t.cclegacy,r=t._decorator,a=t.Node,h=t.RigidBody,l=t.Camera,c=t.Vec3,u=t.ERigidBodyType,g=t.input,_=t.Input,d=t.geometry,T=t.PhysicsSystem,p=t.Tween,y=t.tween,f=t.Component},function(t){v=t.GameManager},function(t){P=t.BlockHighlight}],execute:function(){var E,R,C,H,I;e._RF.push({},"e260eza/d1MsoE4ms9MY/dD","BlockController",void 0);var D=r.ccclass,w=r.property;t("BlockController",(E=D("BlockController"),R=w({type:a,tooltip:"KÃ©o Visual vÃ o Ä‘Ã¢y"}),E((I=i((H=function(t){function i(){for(var i,o=arguments.length,e=new Array(o),r=0;r<o;r++)e[r]=arguments[r];return i=t.call.apply(t,[this].concat(e))||this,s(i,"visualRoot",I,n(i)),i._rb=null,i._isDragging=!1,i._camera=null,i._targetPos=new c,i._startBlockPos=new c,i._startHitPos=new c,i._plane=d.Plane.create(0,1,0,0),i.LIFT_HEIGHT=.5,i.GRID_UNIT=2.2,i.MOVE_SPEED=40,i.MAX_VELOCITY=25,i}o(i,t);var e=i.prototype;return e.start=function(){this._rb=this.getComponent(h),this._camera=this.node.scene.getComponentInChildren(l),this._rb.linearFactor=new c(1,0,1),this._rb.angularFactor=new c(0,0,0),this._rb.useGravity=!1,this._rb.useCCD=!0,this._rb.type=u.STATIC,this._targetPos.set(this.node.worldPosition),this.visualRoot===this.node&&(this.visualRoot=null),g.on(_.EventType.TOUCH_START,this.onTouchStart,this),g.on(_.EventType.TOUCH_MOVE,this.onTouchMove,this),g.on(_.EventType.TOUCH_END,this.onTouchEnd,this)},e.onDestroy=function(){g.off(_.EventType.TOUCH_START,this.onTouchStart,this),g.off(_.EventType.TOUCH_MOVE,this.onTouchMove,this),g.off(_.EventType.TOUCH_END,this.onTouchEnd,this)},e.getGroundHitPoint=function(t,i){var o=new d.Ray;this._camera.screenPointToRay(t.getLocationX(),t.getLocationY(),o);var s=d.intersect.rayPlane(o,this._plane);return s>0&&(o.computeHit(i,s),!0)},e.onTouchStart=function(t){if(this.enabled){var i=new d.Ray;if(this._camera.screenPointToRay(t.getLocationX(),t.getLocationY(),i),T.instance.raycast(i,4294967295,1e3,!0))for(var o=T.instance.raycastResults,s=0;s<o.length;s++)if(o[s].collider.node.isChildOf(this.node)||o[s].collider.node===this.node)return void this.startDrag(t)}},e.startDrag=function(t){p.stopAllByTarget(this.node),this.visualRoot&&p.stopAllByTarget(this.visualRoot),this._startBlockPos.set(this.node.worldPosition),this.getGroundHitPoint(t,this._startHitPos)||this._startHitPos.set(this.node.worldPosition.x,0,this.node.worldPosition.z),this._targetPos.set(this._startBlockPos),this._rb.type=u.DYNAMIC,this._rb.wakeUp(),this._rb.setLinearVelocity(c.ZERO),this._rb.setAngularVelocity(c.ZERO),this.visualRoot&&y(this.visualRoot).to(.1,{position:new c(0,this.LIFT_HEIGHT,0)}).start(),this.toggleHighlight(!0),this._isDragging=!0},e.onTouchMove=function(t){if(this._isDragging){var i=new c;if(this.getGroundHitPoint(t,i)){var o=i.x-this._startHitPos.x,s=i.z-this._startHitPos.z;this._targetPos.x=this._startBlockPos.x+o,this._targetPos.z=this._startBlockPos.z+s,this._targetPos.y=0}}},e.update=function(t){if(this._isDragging&&this._rb){var i=this.node.worldPosition,o=new c;c.subtract(o,this._targetPos,i),o.y=0;var s=o.multiplyScalar(this.MOVE_SPEED);s.lengthSqr()>this.MAX_VELOCITY*this.MAX_VELOCITY&&s.normalize().multiplyScalar(this.MAX_VELOCITY),this._rb.setLinearVelocity(s)}},e.onTouchEnd=function(t){this._isDragging&&(this._isDragging=!1,this._rb.setLinearVelocity(c.ZERO),this._rb.type=u.STATIC,this.visualRoot&&y(this.visualRoot).to(.1,{position:c.ZERO}).start(),this.toggleHighlight(!1),this.snapToGrid())},e.snapToGrid=function(){var t=this.node.worldPosition,i=Math.round(t.x/this.GRID_UNIT)*this.GRID_UNIT,o=Math.round(t.z/this.GRID_UNIT)*this.GRID_UNIT;y(this.node).to(.1,{worldPosition:new c(i,t.y,o)}).call((function(){v.instance.checkPuzzleCondition()})).start()},e.toggleHighlight=function(t){this.node.getComponentsInChildren(P).forEach((function(i){return i.setHighlight(t)}))},i}(f)).prototype,"visualRoot",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=H))||C));e._RF.pop()}}}));

System.register("chunks:///_virtual/BlockHighlight.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(i){var t,e,o,l,n,a,s,c,r,u;return{setters:[function(i){t=i.applyDecoratedDescriptor,e=i.inheritsLoose,o=i.initializerDefineProperty,l=i.assertThisInitialized},function(i){n=i.cclegacy,a=i._decorator,s=i.Node,c=i.tween,r=i.Vec3,u=i.Component}],execute:function(){var h,d,p,v,N,g,f;n._RF.push({},"f8452E8gv9HCbPYmuoGKEfe","BlockHighlight",void 0);var y=a.ccclass,_=a.property;i("BlockHighlight",(h=y("BlockHighlight"),d=_({type:s,tooltip:"KÃ©o cÃ¡i Node 'Visual' gá»‘c vÃ o Ä‘Ã¢y Ä‘á»ƒ scale nhÃºn nháº£y"}),p=_({type:s,tooltip:"KÃ©o cÃ¡i Node Outline (mÃ u vÃ ng) vÃ o Ä‘Ã¢y"}),h((g=t((N=function(i){function t(){for(var t,e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=i.call.apply(i,[this].concat(n))||this,o(t,"visualNode",g,l(t)),o(t,"outlineNode",f,l(t)),t._initialScale=new r,t}e(t,i);var n=t.prototype;return n.start=function(){this.visualNode?this._initialScale.set(this.visualNode.scale):this._initialScale.set(this.node.scale),this.outlineNode&&(this.outlineNode.active=!1)},n.setHighlight=function(i){this.visualNode&&c(this.visualNode).stop(),i?(this.outlineNode&&(this.outlineNode.active=!0),this.visualNode&&c(this.visualNode).to(.1,{scale:this._initialScale.clone().multiplyScalar(1.1)}).start()):(this.outlineNode&&(this.outlineNode.active=!1),this.visualNode&&c(this.visualNode).to(.1,{scale:this._initialScale}).start())},t}(u)).prototype,"visualNode",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=t(N.prototype,"outlineNode",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=N))||v));n._RF.pop()}}}));

System.register("chunks:///_virtual/GameManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./NodeInfo.ts"],(function(e){var o,n,t,r,i,a,s,c,l,u,h,d,f;return{setters:[function(e){o=e.applyDecoratedDescriptor,n=e.inheritsLoose,t=e.createForOfIteratorHelperLoose,r=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){a=e.cclegacy,s=e._decorator,c=e.Prefab,l=e.director,u=e.instantiate,h=e.Vec2,d=e.Component},function(e){f=e.NodeInfo}],execute:function(){var p,g,v,I,P,y;a._RF.push({},"cf856FFqj1A+YkLCSlPgVp+","GameManager",void 0);var G=s.ccclass,D=s.property;e("GameManager",(p=G("GameManager"),g=D({type:c,tooltip:"KÃ©o Prefab hiá»‡u á»©ng ná»• háº¡t (Particle System) vÃ o Ä‘Ã¢y"}),p(((y=function(e){function o(){for(var o,n=arguments.length,t=new Array(n),a=0;a<n;a++)t[a]=arguments[a];return(o=e.call.apply(e,[this].concat(t))||this).GRID_UNIT=2.2,r(o,"explosionPrefab",P,i(o)),o}n(o,e);var a=o.prototype;return a.onLoad=function(){o.instance=this},a.checkPuzzleCondition=function(){var e=this;console.log("------------------------------------------------"),console.log("ðŸ” [GameManager] Báº¯t Ä‘áº§u quÃ©t...");var o=l.getScene();if(o){for(var n,r=o.getComponentsInChildren(f),i=new Map,a=0,s=t(r);!(n=s()).done;){var c=n.value;c.node.activeInHierarchy&&(a++,i.has(c.groupID)||i.set(c.groupID,[]),i.get(c.groupID).push(c))}console.log("ðŸ“Š TÃ¬m tháº¥y: "+a+" máº£nh active."),0!==a&&i.forEach((function(o,n){e.checkGroup(o,n)}))}},a.checkGroup=function(e,o){var n=this;e.sort((function(e,o){return e.nodeID-o.nodeID}));var t=e.length;if(4===t){var r=e[0],i=e[1],a=e[2],s=e[3];if(1!==r.nodeID||2!==i.nodeID||3!==a.nodeID||4!==s.nodeID)return;var c=this.getGridPos(r.node),l=this.getGridPos(i.node),u=this.getGridPos(a.node),h=this.getGridPos(s.node),d=this.isAt(l,c.x+1,c.y),f=this.isAt(u,c.x,c.y-1),p=this.isAt(h,c.x+1,c.y-1);d&&f&&p&&(console.log("âœ… BÃ™M! Bá»™ 4 máº£nh (Group "+o+") khá»›p!"),this.onMatchSuccess(e))}else if(6===t){var g=e[0],v=e[e.length-1];if(1!==g.nodeID||6!==v.nodeID)return;var I=this.getGridPos(g.node),P=function(o,t,r){var i=n.getGridPos(e[o].node);return n.isAt(i,I.x+t,I.y+r)},y=P(1,1,0),G=P(2,0,-1),D=P(3,1,-1),M=P(4,0,-2),m=P(5,1,-2);y&&G&&D&&M&&m&&(console.log("ðŸŽ‰ SIÃŠU BÃ™M! Bá»™ 6 máº£nh (Group "+o+") khá»›p!"),this.onMatchSuccess(e))}},a.onMatchSuccess=function(e){for(var o,n=this,r=new Set,i=t(e);!(o=i()).done;){var a=o.value;a.node.parent&&r.add(a.node.parent)}console.log("ðŸ”¥ KÃ­ch hoáº¡t hiá»‡u á»©ng vá»¡ cho "+r.size+" khá»‘i cha..."),r.forEach((function(e){var o=e.worldPosition.clone();if(console.log("ðŸ’€ ÄÃ£ xÃ³a sá»• ngay láº­p tá»©c: "+e.name),e.destroy(),n.explosionPrefab){var t,r=u(n.explosionPrefab);r.setWorldPosition(o),null==(t=l.getScene())||t.addChild(r),console.log("âœ¨ ÄÃ£ táº¡o hiá»‡u á»©ng ná»• vá»¡ táº¡i "+o)}else console.warn("âš ï¸ Äáº I CA Æ I! ChÆ°a kÃ©o Prefab ná»• vÃ o GameManager kÃ¬a!")}))},a.isAt=function(e,o,n){return Math.abs(e.x-o)<.1&&Math.abs(e.y-n)<.1},a.getGridPos=function(e){var o=Math.round(e.worldPosition.x/this.GRID_UNIT),n=Math.round(e.worldPosition.z/this.GRID_UNIT);return new h(o,n)},o}(d)).instance=void 0,P=o((I=y).prototype,"explosionPrefab",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=I))||v));a._RF.pop()}}}));

System.register("chunks:///_virtual/GridTray.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var i,t,r,n,l,o,a,s,c,p,u,h,f;return{setters:[function(e){i=e.applyDecoratedDescriptor,t=e.inheritsLoose,r=e.createClass,n=e.initializerDefineProperty,l=e.assertThisInitialized},function(e){o=e.cclegacy,a=e._decorator,s=e.CCInteger,c=e.CCFloat,p=e.Prefab,u=e.instantiate,h=e.Vec3,f=e.Component}],execute:function(){var b,d,g,y,w,z,S,v,m,P,C,T,_;o._RF.push({},"10bbcdNKhZFxIe91ARu6aua","GridTray",void 0);var G=a.ccclass,B=a.property,D=a.executeInEditMode;e("TileSpawner",(b=G("TileSpawner"),d=B(s),g=B(s),y=B(c),w=B(c),z=B(p),b(S=D((m=i((v=function(e){function i(){for(var i,t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return i=e.call.apply(e,[this].concat(r))||this,n(i,"rows",m,l(i)),n(i,"cols",P,l(i)),n(i,"cellSize",C,l(i)),n(i,"spacing",T,l(i)),n(i,"tilePrefab",_,l(i)),i}return t(i,e),i.prototype.spawnTiles=function(){if(this.node.removeAllChildren(),this.tilePrefab)for(var e=this.cols*(this.cellSize+this.spacing)-this.spacing,i=this.rows*(this.cellSize+this.spacing)-this.spacing,t=-e/2+this.cellSize/2,r=-i/2+this.cellSize/2,n=0;n<this.rows;n++)for(var l=0;l<this.cols;l++){var o=u(this.tilePrefab);this.node.addChild(o);var a=t+l*(this.cellSize+this.spacing),s=r+n*(this.cellSize+this.spacing);o.setPosition(new h(a,s,0)),o.setScale(new h(this.cellSize,this.cellSize,1)),o.name="Tile_"+n+"_"+l}},r(i,[{key:"BuildGrid",get:function(){return!1},set:function(e){e&&this.spawnTiles()}}]),i}(f)).prototype,"rows",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 11}}),P=i(v.prototype,"cols",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 11}}),C=i(v.prototype,"cellSize",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.9}}),T=i(v.prototype,"spacing",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),_=i(v.prototype,"tilePrefab",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),i(v.prototype,"BuildGrid",[B],Object.getOwnPropertyDescriptor(v.prototype,"BuildGrid"),v.prototype),S=v))||S)||S));o._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./BlockController.ts","./BlockHighlight.ts","./GameManager.ts","./GridTray.ts","./NodeInfo.ts"],(function(){return{setters:[null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/NodeInfo.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,n,r,o,i,a,c,u;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,r=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){i=e.cclegacy,a=e._decorator,c=e.CCInteger,u=e.Component}],execute:function(){var l,p,s,f,y,I,d;i._RF.push({},"26964Mo1QtEvbIt3G0Gu233","NodeInfo",void 0);var b=a.ccclass,h=a.property;e("NodeInfo",(l=b("NodeInfo"),p=h({type:c,tooltip:"Sá»‘ thá»© tá»± cá»§a máº£nh nÃ y (1, 2, 3, 4...)"}),s=h({type:c,tooltip:"ID cá»§a bá»©c tranh/bá»™ nÃ y"}),l((I=t((y=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i))||this,r(t,"nodeID",I,o(t)),r(t,"groupID",d,o(t)),t}return n(t,e),t}(u)).prototype,"nodeID",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),d=t(y.prototype,"groupID",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),f=y))||f));i._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});