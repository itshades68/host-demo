System.register("chunks:///_virtual/Block.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var n,t,o,i,r,l,c,a,s,u,p,d;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,o=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){r=e.cclegacy,l=e._decorator,c=e.Label,a=e.Sprite,s=e.Color,u=e.Vec3,p=e.tween,d=e.Component}],execute:function(){var h,w,b,f,g,v,y;r._RF.push({},"2d794vxiUlBJqLhoYUx83yv","Block",void 0);var k=l.ccclass,B=l.property;e("Block",(h=k("Block"),w=B(c),b=B(a),h((v=n((g=function(e){function n(){for(var n,t=arguments.length,r=new Array(t),l=0;l<t;l++)r[l]=arguments[l];return n=e.call.apply(e,[this].concat(r))||this,o(n,"label",v,i(n)),o(n,"background",y,i(n)),n.colors={0:s.WHITE,2:new s(238,228,218),4:new s(237,224,200),8:new s(242,177,121),16:new s(245,149,99),32:new s(246,124,95),64:new s(246,94,59),128:new s(237,207,114),256:new s(237,204,97),512:new s(237,200,80),1024:new s(237,197,63),2048:new s(237,194,46)},n}t(n,e);var r=n.prototype;return r.setVal=function(e,n){if(void 0===n&&(n=!1),0===e)return this.node.active=!1,void this.node.setSiblingIndex(0);this.node.active=!0,this.node.setSiblingIndex(100),this.label.string=e.toString(),this.colors[e]?this.background.color=this.colors[e]:this.background.color=s.BLACK,this.label.color=e<=4?new s(119,110,101):s.WHITE,n&&(this.node.setScale(new u(1,1,1)),p(this.node).to(.15,{scale:new u(1.2,1.2,1)}).to(.15,{scale:new u(1,1,1)}).start())},r.start=function(){},r.update=function(e){},n}(d)).prototype,"label",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=n(g.prototype,"background",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=g))||f));r._RF.pop()}}}));

System.register("chunks:///_virtual/GameController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Block.ts"],(function(t){var e,i,r,o,a,n,s,h,c,l,u,f,v,g,d,p,S,m,b,O,y,w,C;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,r=t.initializerDefineProperty,o=t.assertThisInitialized,a=t.asyncToGenerator,n=t.regeneratorRuntime},function(t){s=t.cclegacy,h=t._decorator,c=t.Prefab,l=t.Node,u=t.Label,f=t.input,v=t.Input,g=t.Vec3,d=t.Vec2,p=t.KeyCode,S=t.sys,m=t.instantiate,b=t.Color,O=t.tween,y=t.UIOpacity,w=t.Component},function(t){C=t.Block}],execute:function(){var L,k,P,R,G,M,x,E,I,_,T,A,B,W,H;s._RF.push({},"e0ecakavKdGArv1YZtJ7lLm","GameController",void 0);var K=h.ccclass,U=h.property;t("GameController",(L=K("GameController"),k=U(c),P=U(l),R=U(l),G=U(u),M=U(u),x=U(l),L((_=e((I=function(t){function e(){for(var e,i=arguments.length,a=new Array(i),n=0;n<i;n++)a[n]=arguments[n];return e=t.call.apply(t,[this].concat(a))||this,r(e,"blockPrefab",_,o(e)),r(e,"bgLayer",T,o(e)),r(e,"gameLayer",A,o(e)),r(e,"scoreLabel",B,o(e)),r(e,"highScoreLabel",W,o(e)),r(e,"gameOverNode",H,o(e)),e.GAP=20,e.BLOCK_SIZE=125,e.ROWS=4,e.COLS=4,e.data=[],e.blocks=[],e.mergedState=[],e.score=0,e.highScore=0,e.isGameOver=!1,e.isMoving=!1,e.startTouchPos=new g,e}i(e,t);var s=e.prototype;return s.start=function(){this.loadHighScore(),this.initGrid(),this.initBlocks(),this.newGame(),this.node.on(l.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(l.EventType.TOUCH_END,this.onTouchEnd,this),f.on(v.EventType.KEY_UP,this.onKeyUp,this)},s.onDestroy=function(){f.off(v.EventType.KEY_UP,this.onKeyUp,this)},s.onTouchStart=function(t){var e=t.getUILocation();this.startTouchPos=new g(e.x,e.y,0)},s.onTouchEnd=function(t){if(!this.isGameOver&&!this.isMoving){var e=t.getUILocation(),i=new g(e.x,e.y,0).subtract(this.startTouchPos);if(!(i.length()<50)){var r=null;(r=Math.abs(i.x)>Math.abs(i.y)?i.x>0?new d(1,0):new d(-1,0):i.y>0?new d(0,-1):new d(0,1))&&this.processMove(r)}}},s.onKeyUp=function(t){if(!this.isGameOver&&!this.isMoving){var e=null;switch(t.keyCode){case p.ARROW_LEFT:e=new d(-1,0);break;case p.ARROW_RIGHT:e=new d(1,0);break;case p.ARROW_UP:e=new d(0,-1);break;case p.ARROW_DOWN:e=new d(0,1)}e&&this.processMove(e)}},s.processMove=function(){var t=a(n().mark((function t(e){var i,r=this;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((i=this.calculateMoveOutcome(e)).hasMoved){t.next=3;break}return t.abrupt("return");case 3:return this.isMoving=!0,t.next=6,this.animateSlides(i.moveActions);case 6:this.data=i.newData,this.mergedState=i.newMergedState,this.updateScore(i.scoreAdd),this.updateUI(),this.spawnBlock(),this.checkGameOver(),this.scheduleOnce((function(){r.isMoving=!1}),.05);case 13:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),s.calculateMoveOutcome=function(t){for(var e=!1,i=0,r=this.cloneMatrix(this.data),o=this.createEmptyMatrix(!1),a=[],n=t.y>0?this.ROWS-1:0,s=t.y>0?-1:this.ROWS,h=t.y>0?-1:1,c=t.x>0?this.COLS-1:0,l=t.x>0?-1:this.COLS,u=t.x>0?-1:1,f=n;f!==s;f+=h)for(var v=c;v!==l;v+=u)if(0!==r[f][v]){for(var g=f,d=v;;){var p=g+t.y,S=d+t.x;if(p<0||p>=this.ROWS||S<0||S>=this.COLS)break;if(0!==r[p][S]){r[p][S]!==r[f][v]||o[p][S]||(g=p,d=S);break}g=p,d=S}g===f&&d===v||(a.push({fromRow:f,fromCol:v,toRow:g,toCol:d}),r[g][d]===r[f][v]?(r[g][d]*=2,i+=r[g][d],o[g][d]=!0):r[g][d]=r[f][v],r[f][v]=0,e=!0)}return{hasMoved:e,newData:r,newMergedState:o,moveActions:a,scoreAdd:i}},s.animateSlides=function(){var t=a(n().mark((function t(e){var i,r,o=this;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==e.length){t.next=2;break}return t.abrupt("return");case 2:return i=this.getStartPosition(),r=[],e.forEach((function(t){var e=o.data[t.fromRow][t.fromCol];if(0!==e){var a=m(o.blockPrefab);a.parent=o.gameLayer,a.setPosition(o.getPosition(t.fromRow,t.fromCol,i)),a.getComponent(C).setVal(e),a.setSiblingIndex(999),o.blocks[t.fromRow][t.fromCol].node.setScale(new g(0,0,1));var n=o.getPosition(t.toRow,t.toCol,i),s=new Promise((function(t){O(a).to(.1,{position:n},{easing:"sineInOut"}).call((function(){a.destroy(),t()})).start()}));r.push(s)}})),t.next=7,Promise.all(r);case 7:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),s.loadHighScore=function(){var t=S.localStorage.getItem("HIGH_SCORE_2048");this.highScore=t?parseInt(t):0,this.updateHighScoreLabel()},s.saveHighScore=function(){this.score>this.highScore&&(this.highScore=this.score,S.localStorage.setItem("HIGH_SCORE_2048",this.highScore.toString()),this.updateHighScoreLabel())},s.updateHighScoreLabel=function(){this.highScoreLabel&&(this.highScoreLabel.string=""+this.highScore)},s.initGrid=function(){for(var t=this.getStartPosition(),e=0;e<this.ROWS;e++)for(var i=0;i<this.COLS;i++){var r=m(this.blockPrefab);this.bgLayer.addChild(r),r.setPosition(this.getPosition(e,i,t)),r.active=!0;var o=r.getComponent(C).background;o&&(o.color=new b(128,128,128,50));var a=r.getComponent(C);a&&a.label&&(a.label.node.active=!1)}},s.initBlocks=function(){for(var t=this.getStartPosition(),e=0;e<this.ROWS;e++){this.blocks[e]=[],this.data[e]=[],this.mergedState[e]=[];for(var i=0;i<this.COLS;i++){var r=m(this.blockPrefab);this.gameLayer.addChild(r),r.setPosition(this.getPosition(e,i,t));var o=r.getComponent(C);o&&(this.blocks[e][i]=o,this.data[e][i]=0,this.mergedState[e][i]=!1,o.setVal(0))}}},s.newGame=function(){this.isGameOver=!1,this.isMoving=!1,this.gameOverNode.active=!1,this.score=0,this.updateScore(0);for(var t=0;t<this.ROWS;t++)for(var e=0;e<this.COLS;e++)this.data[t][e]=0,this.mergedState[t][e]=!1;this.updateUI(),this.spawnBlock(),this.spawnBlock()},s.onRestartBtnClick=function(){this.newGame()},s.spawnBlock=function(){for(var t=[],e=0;e<this.ROWS;e++)for(var i=0;i<this.COLS;i++)0===this.data[e][i]&&t.push({x:e,y:i});if(0!==t.length){var r=t[Math.floor(Math.random()*t.length)];this.data[r.x][r.y]=Math.random()<.9?2:4;var o=this.blocks[r.x][r.y];o.setVal(this.data[r.x][r.y]),o.node.setScale(new g(0,0,1)),O(o.node).to(.1,{scale:new g(1,1,1)},{easing:"backOut"}).start()}},s.updateUI=function(){for(var t=0;t<this.ROWS;t++)for(var e=0;e<this.COLS;e++){var i=this.blocks[t][e];i.setVal(this.data[t][e],this.mergedState[t][e]);var r=this.getStartPosition();i.node.setPosition(this.getPosition(t,e,r)),this.mergedState[t][e]||i.node.setScale(new g(1,1,1))}},s.checkGameOver=function(){for(var t=0;t<4;t++)for(var e=0;e<4;e++)if(0==this.data[t][e])return;for(var i=0;i<4;i++)for(var r=0;r<3;r++)if(this.data[i][r]==this.data[i][r+1])return;for(var o=0;o<4;o++)for(var a=0;a<3;a++)if(this.data[a][o]==this.data[a+1][o])return;this.doGameOver()},s.doGameOver=function(){var t=this;this.isGameOver=!0,console.log("GAME OVER!"),this.saveHighScore(),this.scheduleOnce((function(){t.gameOverNode.active=!0;var e=t.gameOverNode.getComponent(y);e||(e=t.gameOverNode.addComponent(y)),e.opacity=0,O(e).to(.5,{opacity:255}).start(),t.gameOverNode.setScale(new g(0,0,1)),O(t.gameOverNode).to(.3,{scale:new g(1,1,1)},{easing:"backOut"}).start()}),.5)},s.cloneMatrix=function(t){return t.map((function(t){return[].concat(t)}))},s.createEmptyMatrix=function(t){for(var e=[],i=0;i<this.ROWS;i++)e.push(new Array(this.COLS).fill(t));return e},s.getStartPosition=function(){var t=this.COLS*this.BLOCK_SIZE+(this.COLS-1)*this.GAP,e=this.ROWS*this.BLOCK_SIZE+(this.ROWS-1)*this.GAP,i=-t/2+this.BLOCK_SIZE/2,r=e/2-this.BLOCK_SIZE/2;return new g(i,r,0)},s.getPosition=function(t,e,i){var r=i.x+e*(this.BLOCK_SIZE+this.GAP),o=i.y-t*(this.BLOCK_SIZE+this.GAP);return new g(r,o,0)},s.updateScore=function(t){this.score+=t,this.scoreLabel&&(this.scoreLabel.string=""+this.score),this.saveHighScore()},e}(w)).prototype,"blockPrefab",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=e(I.prototype,"bgLayer",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=e(I.prototype,"gameLayer",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=e(I.prototype,"scoreLabel",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=e(I.prototype,"highScoreLabel",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=e(I.prototype,"gameOverNode",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=I))||E));s._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./Block.ts","./GameController.ts"],(function(){return{setters:[null,null],execute:function(){}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});